{"version":3,"file":"a1772467.js","sources":["../../../src/components/elements/Grid.jsx","../../../src/components/product/ProductGrid.client.jsx"],"sourcesContent":["import clsx from 'clsx';\n\nexport function Grid({\n  as: Component = 'div',\n  className,\n  flow = 'row',\n  gap = 'default',\n  items = 4,\n  layout = 'default',\n  ...props\n}) {\n  const layouts = {\n    default: `grid-cols-1 ${items === 2 && 'md:grid-cols-2'}  ${\n      items === 3 && 'sm:grid-cols-3'\n    } ${items > 3 && 'md:grid-cols-3'} ${items >= 4 && 'lg:grid-cols-4'}`,\n    products: `grid-cols-2 ${items >= 3 && 'md:grid-cols-3'} ${\n      items >= 4 && 'lg:grid-cols-4'\n    }`,\n    auto: 'auto-cols-auto',\n    blog: `grid-cols-2 pt-24`,\n  };\n\n  const gaps = {\n    default: 'grid gap-2 gap-y-6 md:gap-4 lg:gap-6',\n    blog: 'grid gap-6',\n  };\n\n  const flows = {\n    row: 'grid-flow-row',\n    col: 'grid-flow-col',\n  };\n\n  const styles = clsx(flows[flow], gaps[gap], layouts[layout], className);\n\n  return <Component {...props} className={styles} />;\n}\n","import {useState, useRef, useEffect, useCallback} from 'react';\nimport {Link, flattenConnection} from '@shopify/hydrogen';\n\nimport {Button, Grid, ProductCard} from '~/components';\nimport {getImageLoadingPriority} from '~/lib/const';\n\nexport function ProductGrid({url, collection}) {\n  const nextButtonRef = useRef(null);\n  const initialProducts = collection?.products?.nodes || [];\n  const {hasNextPage, endCursor} = collection?.products?.pageInfo ?? {};\n  const [products, setProducts] = useState(initialProducts);\n  const [cursor, setCursor] = useState(endCursor ?? '');\n  const [nextPage, setNextPage] = useState(hasNextPage);\n  const [pending, setPending] = useState(false);\n  const haveProducts = initialProducts.length > 0;\n\n  const fetchProducts = useCallback(async () => {\n    setPending(true);\n    const postUrl = new URL(window.location.origin + url);\n    postUrl.searchParams.set('cursor', cursor);\n\n    const response = await fetch(postUrl, {\n      method: 'POST',\n    });\n    const {data} = await response.json();\n\n    // ProductGrid can paginate collection, products and search routes\n    // @ts-ignore TODO: Fix types\n    const newProducts = flattenConnection(\n      data?.collection?.products || data?.products || [],\n    );\n    const {endCursor, hasNextPage} = data?.collection?.products?.pageInfo ||\n      data?.products?.pageInfo || {endCursor: '', hasNextPage: false};\n\n    setProducts([...products, ...newProducts]);\n    setCursor(endCursor);\n    setNextPage(hasNextPage);\n    setPending(false);\n  }, [cursor, url, products]);\n\n  const handleIntersect = useCallback(\n    (entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          fetchProducts();\n        }\n      });\n    },\n    [fetchProducts],\n  );\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(handleIntersect, {\n      rootMargin: '100%',\n    });\n\n    const nextButton = nextButtonRef.current;\n\n    if (nextButton) observer.observe(nextButton);\n\n    return () => {\n      if (nextButton) observer.unobserve(nextButton);\n    };\n  }, [nextButtonRef, cursor, handleIntersect]);\n\n  if (!haveProducts) {\n    return (\n      <>\n        <p>No products found on this collection</p>\n        <Link to=\"/products\">\n          <p className=\"underline\">Browse catalog</p>\n        </Link>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <Grid layout=\"products\">\n        {products.map((product, i) => (\n          <ProductCard\n            key={product.id}\n            product={product}\n            loading={getImageLoadingPriority(i)}\n          />\n        ))}\n      </Grid>\n\n      {nextPage && (\n        <div\n          className=\"flex items-center justify-center mt-6\"\n          ref={nextButtonRef}\n        >\n          <Button\n            variant=\"secondary\"\n            disabled={pending}\n            onClick={fetchProducts}\n            width=\"full\"\n          >\n            {pending ? 'Loading...' : 'Load more products'}\n          </Button>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["Grid","as","Component","className","flow","gap","items","layout","props","layouts","default","products","auto","blog","gaps","styles","clsx","row","col","ProductGrid","url","collection","nextButtonRef","useRef","initialProducts","nodes","hasNextPage","endCursor","pageInfo","setProducts","useState","cursor","setCursor","nextPage","setNextPage","pending","setPending","haveProducts","length","fetchProducts","useCallback","postUrl","URL","window","location","origin","searchParams","set","response","fetch","method","data","json","newProducts","flattenConnection","handleIntersect","entries","forEach","entry","isIntersecting","useEffect","observer","IntersectionObserver","rootMargin","nextButton","current","observe","unobserve","_Fragment","_jsx","map","product","i","ProductCard","getImageLoadingPriority","id","Button","Link"],"mappings":"kqBAEO,SAASA,EAAK,CACnBC,GAAIC,EAAY,MAChBC,UAAAA,EACAC,KAAAA,EAAO,MACPC,IAAAA,EAAM,UACNC,MAAAA,EAAQ,EACRC,OAAAA,EAAS,aACNC,CAPgB,EAQlB,CACD,MAAMC,EAAU,CACdC,QAAU,eAAcJ,IAAU,GAAK,qBACrCA,IAAU,GAAK,oBACbA,EAAQ,GAAK,oBAAoBA,GAAS,GAAK,mBACnDK,SAAW,eAAcL,GAAS,GAAK,oBACrCA,GAAS,GAAK,mBAEhBM,KAAM,iBACNC,KAAO,mBAAA,EAGHC,EAAO,CACXJ,QAAS,uCACTG,KAAM,YAAA,EAQFE,EAASC,EALD,CACZC,IAAK,gBACLC,IAAK,eAAA,EAGmBd,GAAOU,EAAKT,GAAMI,EAAQF,GAASJ,CAA1C,EAEnB,SAAQD,EAAD,CAAA,GAAeM,EAAO,UAAWO,CAAAA,CAAxC,CACD,CC7BM,SAASI,GAAY,CAACC,IAAAA,EAAKC,WAAAA,CAAN,EAAmB,WACvCC,MAAAA,EAAgBC,iBAAO,IAAD,EACtBC,IAAkBH,EAAAA,GAAAA,YAAAA,EAAYV,WAAZU,YAAAA,EAAsBI,QAAS,CAAA,EACjD,CAACC,YAAAA,EAAaC,UAAAA,CAAaN,GAAAA,GAAAA,EAAAA,GAAAA,YAAAA,EAAYV,WAAZU,YAAAA,EAAsBO,WAAtBP,KAAAA,EAAkC,GAC7D,CAACV,EAAUkB,CAAX,EAA0BC,mBAASN,CAAD,EAClC,CAACO,EAAQC,CAAT,EAAsBF,EAAAA,QAAAA,SAASH,GAAAA,KAAAA,EAAa,EAAd,EAC9B,CAACM,EAAUC,CAAX,EAA0BJ,mBAASJ,CAAD,EAClC,CAACS,EAASC,CAAV,EAAwBN,mBAAS,EAAD,EAChCO,EAAeb,EAAgBc,OAAS,EAExCC,EAAgBC,EAAAA,QAAAA,YAAY,SAAY,aAC5CJ,EAAW,EAAD,EACV,MAAMK,EAAU,IAAIC,IAAIC,OAAOC,SAASC,OAASzB,CAAjC,EACR0B,EAAAA,aAAaC,IAAI,SAAUhB,CAAnC,EAEMiB,MAAAA,EAAW,MAAMC,MAAMR,EAAS,CACpCS,OAAQ,MAAA,CADkB,EAGtB,CAACC,KAAAA,CAAAA,EAAQ,MAAMH,EAASI,OAIxBC,EAAcC,IAClBH,EAAAA,GAAAA,YAAAA,EAAM9B,aAAN8B,YAAAA,EAAkBxC,YAAYwC,GAAAA,YAAAA,EAAMxC,WAAY,CAAA,CADb,EAG/B,CAACgB,UAAAA,EAAWD,YAAAA,CAAAA,IAAeyB,GAAAA,EAAAA,GAAAA,YAAAA,EAAM9B,aAAN8B,YAAAA,EAAkBxC,WAAlBwC,YAAAA,EAA4BvB,aAC3DuB,EAAAA,GAAAA,YAAAA,EAAMxC,WAANwC,YAAAA,EAAgBvB,WAAY,CAACD,UAAW,GAAID,YAAa,EAAA,EAE3DG,EAAY,CAAC,GAAGlB,EAAU,GAAG0C,CAAjB,CAAD,EACXrB,EAAUL,CAAD,EACTO,EAAYR,CAAD,EACXU,EAAW,EAAD,CACT,EAAA,CAACL,EAAQX,EAAKT,CAAd,CAtB8B,EAwB3B4C,EAAkBf,sBACTgB,GAAA,CACXA,EAAQC,QAAmBC,GAAA,CACrBA,EAAMC,gBACKpB,GACd,CAHH,CAAA,EAMF,CAACA,CAAD,CARiC,EAyBnC,OAdAqB,EAAAA,QAAAA,UAAU,IAAM,CACRC,MAAAA,EAAW,IAAIC,qBAAqBP,EAAiB,CACzDQ,WAAY,MAAA,CADG,EAIXC,EAAa1C,EAAc2C,QAE7BD,OAAAA,GAAYH,EAASK,QAAQF,CAAjB,EAET,IAAM,CACPA,GAAYH,EAASM,UAAUH,CAAnB,CAAA,CAEjB,EAAA,CAAC1C,EAAeS,EAAQwB,CAAxB,CAZM,EAcJlB,IAYH+B,EAAA,CAAA,SAAA,CACEC,EAACrE,EAAD,CAAM,OAAO,WAAb,SACGW,EAAS2D,IAAI,CAACC,EAASC,MACrBC,EAAD,CAEE,QAAAF,EACA,QAASG,EAAwBF,CAAD,CAAA,EAF3BD,EAAQI,EADf,CADD,CAAA,CAFL,EAWG1C,GACCoC,EAAA,MAAA,CACE,UAAU,wCACV,IAAK/C,EAFP,WAIGsD,EAAD,CACE,QAAQ,YACR,SAAUzC,EACV,QAASI,EACT,MAAM,OAJR,SAMGJ,EAAU,aAAe,oBAAA,CAN5B,CAAA,CAhBN,CAAA,CAAA,CADF,IATIiC,EAAA,CAAA,SACE,CAAAC,EAAA,IAAA,CAAA,SAAA,sCAAA,CADF,EAEEA,EAACQ,EAAD,CAAM,GAAG,YAAT,WACE,IAAA,CAAG,UAAU,YAAb,SAAA,gBAAA,CAAA,CAAA,CAHJ,CAAA,CAAA,CADF,CAuCH"}